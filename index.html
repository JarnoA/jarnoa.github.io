<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poem Creator</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #2c2c2c;
            font-family: 'Garamond', serif;
            color: #fff;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-align: center;
        }
        .word-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            max-width: 1000px; /* Adjust max-width as needed */
        }
        .word {
            background-color: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            color: #2c2c2c;
            text-align: center;
            flex: none;
        }
        .poem-container {
            border: 1px solid #ccc;
            padding: 10px;
            width: 100%;
            max-width: 300px;
            min-height: 100px;
            background-color: #444;
            text-align: center;
            margin-bottom: 20px;
        }
        #downloadBtn, #regenerateBtn {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 20px;
            margin: 5px;
        }
        #downloadBtn {
            background-color: #f5a623;
            color: #fff;
        }
        #downloadBtn:hover {
            background-color: #ffa941;
        }
        #regenerateBtn {
            background-color: #000;
            color: #fff;
        }
        #regenerateBtn:hover {
            background-color: #333;
        }
    </style>
</head>
<body>
    <h1>Poem Creator</h1>
    <div class="word-container" id="wordContainer"></div>
    <div class="poem-container" id="poemContainer"></div>
    <button id="downloadBtn">Download Poem as PNG</button>
    <button id="regenerateBtn">Regenerate Words</button>

    <script>
        const wordContainer = document.getElementById("wordContainer");
        const poemContainer = document.getElementById("poemContainer");

        async function fetchWords(url) {
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.map(item => item.word);
            } catch (error) {
                console.error(`Error fetching words from ${url}:`, error);
                return [];
            }
        }

        async function generateWords() {
            const nouns = await fetchWords('https://api.datamuse.com/words?ml=animal&topics=nouns&max=5');
            const verbs = await fetchWords('https://api.datamuse.com/words?rel_jja=action&topics=verbs&max=5');
            const adjectives = await fetchWords('https://api.datamuse.com/words?rel_jjb=descriptive&topics=adjectives&max=5');
            const adverbs = await fetchWords('https://api.datamuse.com/words?rel_adv=quickly&topics=adverbs&max=5');
            const prepositions = ["in", "on", "at", "by", "with"]; // Prepositions are less suited for API fetching
            const conjunctions = ["and", "or", "but", "so", "because"]; // Conjunctions are less suited for API fetching
            const pronouns = ["he", "she", "it", "we", "they"];

            const commonWords = [
                "love", "dream", "happy", "night", "sky", "blue", "beautiful", "stars", "shine", "bright",
                "light", "dark", "moon", "sun", "hope", "peace", "joy", "sorrow", "tear", "smile",
                "laugh", "cry", "heart", "soul", "mind", "life", "death", "birth", "nature", "flower",
                "tree", "river", "mountain", "ocean", "whisper", "shout", "silence", "noise", "wind",
                "rain", "storm", "fire", "ice", "warm", "cold", "embrace", "kiss", "touch", "feel"
            ];

            const words = [
                ...nouns,
                ...verbs,
                ...adjectives,
                ...adverbs,
                ...prepositions,
                ...conjunctions,
                ...pronouns,
                ...getRandomWords(commonWords, 10)
            ];
            wordContainer.innerHTML = '';
            words.forEach(word => {
                const wordElement = document.createElement("div");
                wordElement.textContent = word;
                wordElement.classList.add("word");
                wordElement.addEventListener("click", () => {
                    const span = document.createElement("span");
                    span.textContent = word + " ";
                    poemContainer.appendChild(span);
                });
                wordContainer.appendChild(wordElement);
            });
        }

        function getRandomWords(words, num) {
            const shuffled = words.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, num);
        }

        document.getElementById("downloadBtn").addEventListener("click", () => {
            const poemText = poemContainer.textContent.trim();
            if (poemText) {
                const scale = 2; // Scale factor for high DPI
                const canvas = document.createElement("canvas");
                const context = canvas.getContext("2d");
                context.font = `${20 * scale}px 'Garamond', serif`;
                const margin = 50 * scale;
                const maxWidth = 400 * scale;
                const words = poemText.split(" ");
                let line = "";
                const lines = [];
                
                words.forEach(word => {
                    const testLine = line + word + " ";
                    const metrics = context.measureText(testLine);
                    const testWidth = metrics.width;
                    if (testWidth > maxWidth && line.length > 0) {
                        lines.push(line.trim());
                        line = word + " ";
                    } else {
                        line = testLine;
                    }
                });
                lines.push(line.trim());

                const lineHeight = 40 * scale;
                const height = lines.length * lineHeight + margin * 2 + 30 * scale; // additional 30 for the footer text
                canvas.width = maxWidth + margin * 2;
                canvas.height = height;
                
                context.fillStyle = "#444";
                context.fillRect(0, 0, canvas.width, canvas.height);
                context.fillStyle = "#fff";
                context.textAlign = "center";
                context.font = `${20 * scale}px 'Garamond', serif`;

                lines.forEach((line, index) => {
                    context.fillText(line, canvas.width / 2, margin + (index + 1) * lineHeight);
                });

                // Add footer text
                context.font = `${12 * scale}px 'Garamond', serif`;
                context.fillStyle = "#b0b0b0"; // Light grey color for the footer text
                context.fillText("made with jarnoa.github.io", canvas.width / 2, height - 20 * scale);

                const img = canvas.toDataURL("image/png");
                const link = document.createElement("a");
                link.href = img;
                link.download = "poem.png";
                link.click();
            }
        });

        document.getElementById("regenerateBtn").addEventListener("click", () => {
            generateWords();
        });

        generateWords();
    </script>
    <p>V.0.08</p>
</body>
</html>
